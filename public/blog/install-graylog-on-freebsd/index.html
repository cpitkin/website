<!DOCTYPE html>
<html lang="en-US">
    <head>
        

        <title>
            
            
                Install Graylog on Freebsd 10.3 | Charlie Pitkin
            
        </title>

        <meta name="title" content="Install Graylog on Freebsd 10.3 | Charlie Pitkin">

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="referrer" content="no-referrer-when-downgrade">
        <meta name="generator" content="">
        <base href="https://charliepitkin.com">
        <meta name="description" content="All the things!">
        
        <meta name="author" content="Charlie Pitkin">
        
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@charlespitkin">
        <meta name="twitter:creator" content="@charlespitkin">
        
        <meta property="og:title" content="Install Graylog on Freebsd 10.3 | Charlie Pitkin">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://charliepitkin.com">
        <meta property="og:image" content="https://charliepitkin.com/img/osaka-castle_400x400.jpg">
        <meta property="og:description" content="All the things!">
        

        
        <link rel="icon" type="image/png" sizes="16x16" href="https://charliepitkin.com/images/logo/favicon.ico">
        <meta name="theme-color" content="#FFF">
        

        <link rel="canonical" href="https://charliepitkin.com/blog/install-graylog-on-freebsd/">
        
        <link rel="stylesheet" href="https://charliepitkin.com/styles/main.css" type="text/css">
        
        <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/github.min.css">
        
    </head>

    <body>
        

        

        <nav class="row middle-xs center-xs">
            <div class="col-xs-6 col-sm-1 logo">
                <a href="https://charliepitkin.com"><img src="https://charliepitkin.com/img/osaka-castle_400x400.jpg" alt="Charlie Pitkin"></a>
            </div>
            
            <div class="col-xs-3 col-sm-2"><h3><a href="https://charliepitkin.com/blog">blog</a></h3></div>
            
            <div class="col-xs-6 col-sm-1 nav-toggle">
                <a href="" class="nav-icon" onclick="return false"><img src="https://charliepitkin.com/images/icon-menu.png" alt="Open Menu"><img src="https://charliepitkin.com/images/icon-x.png" alt="Close Menu" style="display: none;"></a>
            </div>
        </nav>
        <section class="nav-full row middle-xs center-xs">
            <div class="col-xs-12">
                <div class="row middle-xs center-xs">
                    
                    <div class="col-xs-12"><h1><a href="https://charliepitkin.com/blog">blog</a></h1></div>
                    
                </div>
            </div>
        </section>
        <main>


    <section class="container">
        <section class="content">
            <h1> Install Graylog on Freebsd 10.3 </h1>

            <div class="sub-header">
                August 2017 Â· 4 minute read
            </div>

            <article class="entry-content">
                

<p>I have always needed a central logging server at home. After setting up a couple for my day job I finally decided to setup one for my home servers. This guide is meant to serve as a way install Graylog into FreeBSD. The FreeBSD server is a jail running in FreeNAS 9.10. We are looking to install Graylog 1.3.3 with the web interface. I know Graylog has moved to 2.0 but as of now, the FreeBSD packages are on version 1.3.3. This setup has been working on my server for 15 days so far with an input of 3-6 msgs a second. This guide assumes you already have access to the machine via ssh. [Graylog]: (<a href="https://www.graylog.org">https://www.graylog.org</a>)</p>

<p>Nano is my editor of choice in the terminal so all the examples will use it. To install (it is not installed by default) run <code>pkg install nano</code>. Feel free to use the editor of your choice.</p>

<p>First, we will want to configure and start ntpd. This will make sure we have an accurate time for indexes and logs flowing into the system. <strong>NOTE:</strong> If you are running this in a jail you need to setup the ntpd service on the host not in the jail.</p>

<p>First lets enable the service.
<code>echo &quot;ntpd_enable=&quot;YES&quot; &gt;&gt; /etc/rc.conf</code></p>

<p>Then we need to add some time servers. I always use the time servers from <a href="http://www.pool.ntp.org/en/">pool.ntp.org</a></p>

<p>Check <code>/etc/ntpd.conf</code>. If you have the following lines in your file then you don&rsquo;t need to do anything.</p>

<pre><code>server 0.freebsd.pool.ntp.org iburst                                            server 1.freebsd.pool.ntp.org iburst                                            server 2.freebsd.pool.ntp.org iburst                                            #server 3.freebsd.pool.ntp.org iburst
</code></pre>

<p>If you do not have the lines above add the lines below to <code>/etc/ntpd.conf</code></p>

<pre><code>cat &lt;&lt;EOF &gt;&gt; /etc/ntp.conf
server 0.north-america.pool.ntp.org
server 1.north-america.pool.ntp.org
server 2.north-america.pool.ntp.org
server 3.north-america.pool.ntp.org
EOF
</code></pre>

<p>Now start the service.
<code>service ntpd start</code></p>

<h3 id="install">Install</h3>

<p>Now we need to install the graylog and its dependancies.
<code>pkg install -y mongodb elasticsearch graylog graylog-web-interface pwgen</code></p>

<p>Copy the following and run it to make sure all the needed services are started on boot.</p>

<pre><code>cat &lt;&lt;EOF &gt;&gt; /etc/rc.conf
# Graylog with dependancies
graylog_enable=&quot;YES&quot;
graylog_web_interface_enable=&quot;YES&quot;
elasticsearch_enable=&quot;YES&quot;
mongod_enable=&quot;YES&quot;
EOF
</code></pre>

<h3 id="elastic-search-configs">Elastic Search Configs</h3>

<p><code>pw groupmod elasticsearch -m graylog</code>
<code>nano /usr/local/etc/elasticsearch/elasticsearch.yml</code></p>

<ul>
<li>network.host: 127.0.0.1</li>
</ul>

<h3 id="mongo-db-configs">Mongo DB Configs</h3>

<p>First lets start Mongo.
<code>service mongod start</code></p>

<p>Open the mongo configuration file.
<code>nano /usr/local/etc/mongodb.conf</code></p>

<p>Add the following to the file and save.</p>

<pre><code>net:
  port: 27017
  bindIp: 127.0.0.1
  security:   
    authorization: enabled
</code></pre>

<p>Start the mongo interactive shell
<code>mongo</code></p>

<p>Switch to the admin user
<code>use graylog2</code></p>

<p>Create a user with the rw role to the database graylog2. Graylog creates the graylog2 database so do not replace this value.</p>

<pre><code>db.createUser({
  user: &quot;graylog&quot;,
  pwd: &quot;MY_SUPER_SECRET_PASSWORD&quot;,
  roles: [
    {
      role: &quot;readWrite\&quot;,
      db:&quot;graylog2&quot;
    }
  ]  
})
</code></pre>

<p>Exit the shell
<code>exit</code></p>

<p>Lets restart mongo to load in the new configurations.
<code>service mongod restart</code></p>

<h3 id="graylog-server-configs">Graylog Server Configs</h3>

<p>Change directory into graylog then copy the example configuration to the the graylong.conf (which is not there by default). Next we can touch node-id which we will need in a minute.
<code>cd /usr/local/etc/graylog &amp;&amp; cp graylog.conf.example graylog.conf &amp;&amp; touch node-id &amp;&amp; chown graylog:graylog node-id</code></p>

<p>Open the config file
<code>nano /usr/local/etc/graylog/graylog.conf</code></p>

<p>All of the configation options below are in different parts of the file and are commented as needed.</p>

<pre><code>node_id_file = /usr/local/etc/graylog/node-id
#Generate one by using for example: pwgen -N 1 -s 96\npassword_secret =
root_username = admin

#echo -n yourpassword | shasum -a 256
root_password_sha2 = hash from the above command

root_email =&quot;YOU_EMAIL_HERE&quot;
graylog2-server.uris=&quot;http://&lt;your-server-ip&gt;:12900//&quot;

rest_enable_gzip = true
rest_enable_tls = true

elasticsearch_cluster_name = elasticsearch
elasticsearch_discovery_zen_ping_multicast_enabled = false
elasticsearch_discovery_zen_ping_unicast_hosts =         127.0.0.1:9300
elasticsearch_max_time_per_index = 1w

#mongodb_uri = mongodb://localhost/graylog2
mongodb_uri = mongodb://graylog:MY_SUPER_SECRET_PASSWORD@localhost:27017/graylog2
</code></pre>

<p>Start the service
<code>service graylog start</code></p>

<h4 id="graylog-web-interface-configs">Graylog Web Interface Configs</h4>

<p>Change directory and edit the graylog web interface configuration file
<code>cd .. &amp;&amp; nano graylog-web-interface.conf</code></p>

<pre><code>graylog2-server.uris=&quot;https://127.0.0.1:12900/&quot;
# Generate for example with: pwgen -N 1 -s 96
application.secret=&quot;&quot;

timezone=&quot;America/Chicago&quot;

# This needs to be enabled to allow for a self-signed certificate. If you're using a valid certificate this can be set to false.
graylog2.client.accept-any-certificate=true
</code></pre>

<p>Start the web interface
<code>service graylog_web_interface start</code></p>

<p>Open your browser and go to <code>http://HOSTNAME:9000</code></p>

<p>I hope this gives you some help with configuring your own central log server.</p>

            </article>

            <div class="pagination">
                
                
                    <a href="https://charliepitkin.com/blog/new-site/">New Site &raquo;</a>
                
            </div>
        </section>
        <br>
        <section class="disqus">
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        (function() {
            
            
            if (window.location.hostname == "localhost")
                return;
            var disqus_shortname = '';
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view comments powered by <a href="http://disqus.com/?ref_noscript">Disqus</a>.</noscript>
</section>

    </section>

        </main>
        <footer class="row middle-xs center-xs">
            
            <div class="col-xs-3 col-md-2"><a href="https://github.com/cpitkin">GitHub</a></div>
            
            
            <div class="col-xs-3 col-md-2"><a href="https://linkedin.com/in/cpitkin">LinkedIn</a></div>
            
            
            <div class="col-xs-3 col-md-2"><a href="https://twitter.com/charlespitkin">Twitter</a></div>
            
            
            <div class="col-xs-12">
                
                Copyright &copy; 2018 Charlie Pitkin.
                
                
                Theme developed by <a href="https://tomanistor.com">Toma Nistor</a>.
                
            </div>
            
            
            <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
            
            <script src="https://charliepitkin.com/scripts/main.js" type="text/javascript"></script>
            
            <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
        </footer>
    </body>
</html>

